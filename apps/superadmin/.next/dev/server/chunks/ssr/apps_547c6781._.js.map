{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/wamp64/www/crm-leads/crm/apps/shared/src/ui/Button.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport type { ButtonHTMLAttributes } from \"react\";\r\n\r\nexport interface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {\r\n  variant?: \"primary\" | \"secondary\" | \"outline\";\r\n}\r\n\r\nexport function Button({\r\n  variant = \"primary\",\r\n  className = \"\",\r\n  children,\r\n  ...props\r\n}: ButtonProps) {\r\n  const base =\r\n    \"inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\";\r\n  const variants = {\r\n    primary: \"bg-blue-600 text-white hover:bg-blue-700 focus-visible:ring-blue-600\",\r\n    secondary: \"bg-gray-200 text-gray-900 hover:bg-gray-300 focus-visible:ring-gray-500\",\r\n    outline: \"border border-gray-300 bg-transparent hover:bg-gray-50 focus-visible:ring-gray-500\",\r\n  };\r\n  return (\r\n    <button\r\n      type=\"button\"\r\n      className={`${base} ${variants[variant]} ${className}`}\r\n      {...props}\r\n    >\r\n      {children}\r\n    </button>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;;AAQO,SAAS,OAAO,EACrB,UAAU,SAAS,EACnB,YAAY,EAAE,EACd,QAAQ,EACR,GAAG,OACS;IACZ,MAAM,OACJ;IACF,MAAM,WAAW;QACf,SAAS;QACT,WAAW;QACX,SAAS;IACX;IACA,qBACE,8OAAC;QACC,MAAK;QACL,WAAW,GAAG,KAAK,CAAC,EAAE,QAAQ,CAAC,QAAQ,CAAC,CAAC,EAAE,WAAW;QACrD,GAAG,KAAK;kBAER;;;;;;AAGP"}},
    {"offset": {"line": 33, "column": 0}, "map": {"version":3,"sources":["file:///C:/wamp64/www/crm-leads/crm/apps/shared/src/ui/index.ts"],"sourcesContent":["export { Button } from \"./Button\";\r\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/wamp64/www/crm-leads/crm/apps/superadmin/src/app/actions/workspaces.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { getCurrentUser, getRole } from \"@crm/shared/auth\";\r\nimport { createSupabaseServerClient } from \"@/lib/supabase-server\";\r\nimport { createSupabaseAdminClient } from \"@/lib/supabase-admin\";\r\nimport {\r\n  sendWorkspaceCreatedEmail,\r\n  sendWorkspaceDisabledEmail,\r\n  sendWorkspaceEnabledEmail,\r\n} from \"@/lib/email\";\r\nimport type { Workspace } from \"@/lib/types\";\r\n\r\nconst SUPERADMIN_ONLY = \"Only superadmin can perform this action.\";\r\n\r\nasync function requireSuperadmin() {\r\n  const client = await createSupabaseServerClient();\r\n  const user = await getCurrentUser(client);\r\n  if (!user) throw new Error(\"Unauthorized\");\r\n  if (getRole(user) !== \"superadmin\") throw new Error(SUPERADMIN_ONLY);\r\n  return user;\r\n}\r\n\r\n/** Dashboard counts (superadmin only): total workspaces and total leads. */\r\nexport async function getDashboardCounts(): Promise<{\r\n  workspacesCount: number;\r\n  leadsCount: number;\r\n}> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const [workspacesRes, leadsRes] = await Promise.all([\r\n    admin.from(\"workspaces\").select(\"*\", { count: \"exact\", head: true }),\r\n    admin.from(\"leads\").select(\"*\", { count: \"exact\", head: true }),\r\n  ]);\r\n  return {\r\n    workspacesCount: workspacesRes.count ?? 0,\r\n    leadsCount: leadsRes.count ?? 0,\r\n  };\r\n}\r\n\r\n/** List all workspaces (superadmin only). Resolves owner email from auth. */\r\nexport async function listWorkspaces(): Promise<Workspace[]> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { data, error } = await admin\r\n    .from(\"workspaces\")\r\n    .select(\"id, name, user_id, disabled, created_at\")\r\n    .order(\"created_at\", { ascending: false });\r\n  if (error) throw new Error(error.message);\r\n  const rows = (data ?? []) as Workspace[];\r\n  const withEmailsAndCounts = await Promise.all(\r\n    rows.map(async (w) => {\r\n      let owner_email: string | null = null;\r\n      if (w.user_id?.trim()) {\r\n        const { data: userData } = await admin.auth.admin.getUserById(w.user_id);\r\n        owner_email = userData?.user?.email ?? null;\r\n      }\r\n      const { count } = await admin\r\n        .from(\"leads\")\r\n        .select(\"*\", { count: \"exact\", head: true })\r\n        .eq(\"workspace_id\", w.id);\r\n      const leads_count = count ?? 0;\r\n      return { ...w, owner_email, leads_count };\r\n    })\r\n  );\r\n  return withEmailsAndCounts;\r\n}\r\n\r\n/** Create a workspace (superadmin only). Uses current user as initial owner until workspace admin is created. */\r\nexport async function createWorkspace(name: string): Promise<Workspace> {\r\n  const user = await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { data, error } = await admin\r\n    .from(\"workspaces\")\r\n    .insert({ name, user_id: user.id })\r\n    .select(\"id, name, user_id, disabled, created_at\")\r\n    .single();\r\n  if (error) throw new Error(error.message);\r\n  return data as Workspace;\r\n}\r\n\r\n/** Create a workspace admin user in Supabase Auth and assign them as workspace owner (superadmin only). */\r\nexport async function createWorkspaceAdminUser(\r\n  workspaceId: number,\r\n  email: string,\r\n  password: string\r\n): Promise<void> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n\r\n  const { data: newUser, error: createError } = await admin.auth.admin.createUser({\r\n    email,\r\n    password,\r\n    email_confirm: true,\r\n    user_metadata: {\r\n      role: \"workspace_admin\",\r\n      workspace_id: workspaceId,\r\n    },\r\n  });\r\n  if (createError) throw new Error(createError.message);\r\n  if (!newUser.user) throw new Error(\"User creation failed\");\r\n\r\n  const { error: updateError } = await admin\r\n    .from(\"workspaces\")\r\n    .update({ user_id: newUser.user.id })\r\n    .eq(\"id\", workspaceId);\r\n  if (updateError) throw new Error(updateError.message);\r\n}\r\n\r\n/** Set workspace disabled flag (superadmin only). Disabled workspace admins cannot log in to the workspace app. Sends email to workspace admin. */\r\nexport async function updateWorkspaceDisabled(\r\n  workspaceId: number,\r\n  disabled: boolean\r\n): Promise<void> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { error } = await admin\r\n    .from(\"workspaces\")\r\n    .update({ disabled })\r\n    .eq(\"id\", workspaceId);\r\n  if (error) throw new Error(error.message);\r\n  const { data: workspace } = await admin\r\n    .from(\"workspaces\")\r\n    .select(\"name, user_id\")\r\n    .eq(\"id\", workspaceId)\r\n    .single();\r\n  if (workspace?.user_id) {\r\n    const { data: userData } = await admin.auth.admin.getUserById(\r\n      workspace.user_id as string\r\n    );\r\n    const ownerEmail = userData?.user?.email;\r\n    if (ownerEmail && workspace.name) {\r\n      if (disabled) {\r\n        await sendWorkspaceDisabledEmail(ownerEmail, workspace.name as string);\r\n      } else {\r\n        await sendWorkspaceEnabledEmail(ownerEmail, workspace.name as string);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/** Notify workspace admin by email when a new workspace is created (superadmin only). No-op if SMTP not configured. */\r\nexport async function notifyWorkspaceCreated(\r\n  workspaceName: string,\r\n  adminEmail: string\r\n): Promise<void> {\r\n  await requireSuperadmin();\r\n  await sendWorkspaceCreatedEmail(adminEmail, workspaceName);\r\n}\r\n\r\n/** Delete a workspace by id (superadmin only). Cascades to leads. */\r\nexport async function deleteWorkspace(workspaceId: number): Promise<void> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { error } = await admin.from(\"workspaces\").delete().eq(\"id\", workspaceId);\r\n  if (error) throw new Error(error.message);\r\n}\r\n\r\nconst WORKSPACE_APP_URL =\r\n  process.env.NEXT_PUBLIC_WORKSPACE_APP_URL ?? \"http://localhost:3002\";\r\n\r\n/** Get magic link to open workspace app as superadmin in the given workspace (superadmin only). */\r\nexport async function getWorkspaceLoginLink(\r\n  workspaceId: number\r\n): Promise<{ url: string }> {\r\n  const user = await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const redirectTo = `${WORKSPACE_APP_URL.replace(/\\/$/, \"\")}/auth/enter?workspace_id=${workspaceId}`;\r\n  const { data, error } = await admin.auth.admin.generateLink({\r\n    type: \"magiclink\",\r\n    email: user.email,\r\n    options: { redirectTo },\r\n  });\r\n  if (error) throw new Error(error.message);\r\n  const link =\r\n    (data as { properties?: { action_link?: string } })?.properties\r\n      ?.action_link;\r\n  if (!link) throw new Error(\"Failed to generate link\");\r\n  return { url: link };\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAsJsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,mDAAA"}},
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":["file:///C:/wamp64/www/crm-leads/crm/apps/superadmin/src/app/actions/workspaces.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { getCurrentUser, getRole } from \"@crm/shared/auth\";\r\nimport { createSupabaseServerClient } from \"@/lib/supabase-server\";\r\nimport { createSupabaseAdminClient } from \"@/lib/supabase-admin\";\r\nimport {\r\n  sendWorkspaceCreatedEmail,\r\n  sendWorkspaceDisabledEmail,\r\n  sendWorkspaceEnabledEmail,\r\n} from \"@/lib/email\";\r\nimport type { Workspace } from \"@/lib/types\";\r\n\r\nconst SUPERADMIN_ONLY = \"Only superadmin can perform this action.\";\r\n\r\nasync function requireSuperadmin() {\r\n  const client = await createSupabaseServerClient();\r\n  const user = await getCurrentUser(client);\r\n  if (!user) throw new Error(\"Unauthorized\");\r\n  if (getRole(user) !== \"superadmin\") throw new Error(SUPERADMIN_ONLY);\r\n  return user;\r\n}\r\n\r\n/** Dashboard counts (superadmin only): total workspaces and total leads. */\r\nexport async function getDashboardCounts(): Promise<{\r\n  workspacesCount: number;\r\n  leadsCount: number;\r\n}> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const [workspacesRes, leadsRes] = await Promise.all([\r\n    admin.from(\"workspaces\").select(\"*\", { count: \"exact\", head: true }),\r\n    admin.from(\"leads\").select(\"*\", { count: \"exact\", head: true }),\r\n  ]);\r\n  return {\r\n    workspacesCount: workspacesRes.count ?? 0,\r\n    leadsCount: leadsRes.count ?? 0,\r\n  };\r\n}\r\n\r\n/** List all workspaces (superadmin only). Resolves owner email from auth. */\r\nexport async function listWorkspaces(): Promise<Workspace[]> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { data, error } = await admin\r\n    .from(\"workspaces\")\r\n    .select(\"id, name, user_id, disabled, created_at\")\r\n    .order(\"created_at\", { ascending: false });\r\n  if (error) throw new Error(error.message);\r\n  const rows = (data ?? []) as Workspace[];\r\n  const withEmailsAndCounts = await Promise.all(\r\n    rows.map(async (w) => {\r\n      let owner_email: string | null = null;\r\n      if (w.user_id?.trim()) {\r\n        const { data: userData } = await admin.auth.admin.getUserById(w.user_id);\r\n        owner_email = userData?.user?.email ?? null;\r\n      }\r\n      const { count } = await admin\r\n        .from(\"leads\")\r\n        .select(\"*\", { count: \"exact\", head: true })\r\n        .eq(\"workspace_id\", w.id);\r\n      const leads_count = count ?? 0;\r\n      return { ...w, owner_email, leads_count };\r\n    })\r\n  );\r\n  return withEmailsAndCounts;\r\n}\r\n\r\n/** Create a workspace (superadmin only). Uses current user as initial owner until workspace admin is created. */\r\nexport async function createWorkspace(name: string): Promise<Workspace> {\r\n  const user = await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { data, error } = await admin\r\n    .from(\"workspaces\")\r\n    .insert({ name, user_id: user.id })\r\n    .select(\"id, name, user_id, disabled, created_at\")\r\n    .single();\r\n  if (error) throw new Error(error.message);\r\n  return data as Workspace;\r\n}\r\n\r\n/** Create a workspace admin user in Supabase Auth and assign them as workspace owner (superadmin only). */\r\nexport async function createWorkspaceAdminUser(\r\n  workspaceId: number,\r\n  email: string,\r\n  password: string\r\n): Promise<void> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n\r\n  const { data: newUser, error: createError } = await admin.auth.admin.createUser({\r\n    email,\r\n    password,\r\n    email_confirm: true,\r\n    user_metadata: {\r\n      role: \"workspace_admin\",\r\n      workspace_id: workspaceId,\r\n    },\r\n  });\r\n  if (createError) throw new Error(createError.message);\r\n  if (!newUser.user) throw new Error(\"User creation failed\");\r\n\r\n  const { error: updateError } = await admin\r\n    .from(\"workspaces\")\r\n    .update({ user_id: newUser.user.id })\r\n    .eq(\"id\", workspaceId);\r\n  if (updateError) throw new Error(updateError.message);\r\n}\r\n\r\n/** Set workspace disabled flag (superadmin only). Disabled workspace admins cannot log in to the workspace app. Sends email to workspace admin. */\r\nexport async function updateWorkspaceDisabled(\r\n  workspaceId: number,\r\n  disabled: boolean\r\n): Promise<void> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { error } = await admin\r\n    .from(\"workspaces\")\r\n    .update({ disabled })\r\n    .eq(\"id\", workspaceId);\r\n  if (error) throw new Error(error.message);\r\n  const { data: workspace } = await admin\r\n    .from(\"workspaces\")\r\n    .select(\"name, user_id\")\r\n    .eq(\"id\", workspaceId)\r\n    .single();\r\n  if (workspace?.user_id) {\r\n    const { data: userData } = await admin.auth.admin.getUserById(\r\n      workspace.user_id as string\r\n    );\r\n    const ownerEmail = userData?.user?.email;\r\n    if (ownerEmail && workspace.name) {\r\n      if (disabled) {\r\n        await sendWorkspaceDisabledEmail(ownerEmail, workspace.name as string);\r\n      } else {\r\n        await sendWorkspaceEnabledEmail(ownerEmail, workspace.name as string);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/** Notify workspace admin by email when a new workspace is created (superadmin only). No-op if SMTP not configured. */\r\nexport async function notifyWorkspaceCreated(\r\n  workspaceName: string,\r\n  adminEmail: string\r\n): Promise<void> {\r\n  await requireSuperadmin();\r\n  await sendWorkspaceCreatedEmail(adminEmail, workspaceName);\r\n}\r\n\r\n/** Delete a workspace by id (superadmin only). Cascades to leads. */\r\nexport async function deleteWorkspace(workspaceId: number): Promise<void> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { error } = await admin.from(\"workspaces\").delete().eq(\"id\", workspaceId);\r\n  if (error) throw new Error(error.message);\r\n}\r\n\r\nconst WORKSPACE_APP_URL =\r\n  process.env.NEXT_PUBLIC_WORKSPACE_APP_URL ?? \"http://localhost:3002\";\r\n\r\n/** Get magic link to open workspace app as superadmin in the given workspace (superadmin only). */\r\nexport async function getWorkspaceLoginLink(\r\n  workspaceId: number\r\n): Promise<{ url: string }> {\r\n  const user = await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const redirectTo = `${WORKSPACE_APP_URL.replace(/\\/$/, \"\")}/auth/enter?workspace_id=${workspaceId}`;\r\n  const { data, error } = await admin.auth.admin.generateLink({\r\n    type: \"magiclink\",\r\n    email: user.email,\r\n    options: { redirectTo },\r\n  });\r\n  if (error) throw new Error(error.message);\r\n  const link =\r\n    (data as { properties?: { action_link?: string } })?.properties\r\n      ?.action_link;\r\n  if (!link) throw new Error(\"Failed to generate link\");\r\n  return { url: link };\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAiKsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,yDAAA"}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///C:/wamp64/www/crm-leads/crm/apps/superadmin/src/app/actions/workspaces.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { getCurrentUser, getRole } from \"@crm/shared/auth\";\r\nimport { createSupabaseServerClient } from \"@/lib/supabase-server\";\r\nimport { createSupabaseAdminClient } from \"@/lib/supabase-admin\";\r\nimport {\r\n  sendWorkspaceCreatedEmail,\r\n  sendWorkspaceDisabledEmail,\r\n  sendWorkspaceEnabledEmail,\r\n} from \"@/lib/email\";\r\nimport type { Workspace } from \"@/lib/types\";\r\n\r\nconst SUPERADMIN_ONLY = \"Only superadmin can perform this action.\";\r\n\r\nasync function requireSuperadmin() {\r\n  const client = await createSupabaseServerClient();\r\n  const user = await getCurrentUser(client);\r\n  if (!user) throw new Error(\"Unauthorized\");\r\n  if (getRole(user) !== \"superadmin\") throw new Error(SUPERADMIN_ONLY);\r\n  return user;\r\n}\r\n\r\n/** Dashboard counts (superadmin only): total workspaces and total leads. */\r\nexport async function getDashboardCounts(): Promise<{\r\n  workspacesCount: number;\r\n  leadsCount: number;\r\n}> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const [workspacesRes, leadsRes] = await Promise.all([\r\n    admin.from(\"workspaces\").select(\"*\", { count: \"exact\", head: true }),\r\n    admin.from(\"leads\").select(\"*\", { count: \"exact\", head: true }),\r\n  ]);\r\n  return {\r\n    workspacesCount: workspacesRes.count ?? 0,\r\n    leadsCount: leadsRes.count ?? 0,\r\n  };\r\n}\r\n\r\n/** List all workspaces (superadmin only). Resolves owner email from auth. */\r\nexport async function listWorkspaces(): Promise<Workspace[]> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { data, error } = await admin\r\n    .from(\"workspaces\")\r\n    .select(\"id, name, user_id, disabled, created_at\")\r\n    .order(\"created_at\", { ascending: false });\r\n  if (error) throw new Error(error.message);\r\n  const rows = (data ?? []) as Workspace[];\r\n  const withEmailsAndCounts = await Promise.all(\r\n    rows.map(async (w) => {\r\n      let owner_email: string | null = null;\r\n      if (w.user_id?.trim()) {\r\n        const { data: userData } = await admin.auth.admin.getUserById(w.user_id);\r\n        owner_email = userData?.user?.email ?? null;\r\n      }\r\n      const { count } = await admin\r\n        .from(\"leads\")\r\n        .select(\"*\", { count: \"exact\", head: true })\r\n        .eq(\"workspace_id\", w.id);\r\n      const leads_count = count ?? 0;\r\n      return { ...w, owner_email, leads_count };\r\n    })\r\n  );\r\n  return withEmailsAndCounts;\r\n}\r\n\r\n/** Create a workspace (superadmin only). Uses current user as initial owner until workspace admin is created. */\r\nexport async function createWorkspace(name: string): Promise<Workspace> {\r\n  const user = await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { data, error } = await admin\r\n    .from(\"workspaces\")\r\n    .insert({ name, user_id: user.id })\r\n    .select(\"id, name, user_id, disabled, created_at\")\r\n    .single();\r\n  if (error) throw new Error(error.message);\r\n  return data as Workspace;\r\n}\r\n\r\n/** Create a workspace admin user in Supabase Auth and assign them as workspace owner (superadmin only). */\r\nexport async function createWorkspaceAdminUser(\r\n  workspaceId: number,\r\n  email: string,\r\n  password: string\r\n): Promise<void> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n\r\n  const { data: newUser, error: createError } = await admin.auth.admin.createUser({\r\n    email,\r\n    password,\r\n    email_confirm: true,\r\n    user_metadata: {\r\n      role: \"workspace_admin\",\r\n      workspace_id: workspaceId,\r\n    },\r\n  });\r\n  if (createError) throw new Error(createError.message);\r\n  if (!newUser.user) throw new Error(\"User creation failed\");\r\n\r\n  const { error: updateError } = await admin\r\n    .from(\"workspaces\")\r\n    .update({ user_id: newUser.user.id })\r\n    .eq(\"id\", workspaceId);\r\n  if (updateError) throw new Error(updateError.message);\r\n}\r\n\r\n/** Set workspace disabled flag (superadmin only). Disabled workspace admins cannot log in to the workspace app. Sends email to workspace admin. */\r\nexport async function updateWorkspaceDisabled(\r\n  workspaceId: number,\r\n  disabled: boolean\r\n): Promise<void> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { error } = await admin\r\n    .from(\"workspaces\")\r\n    .update({ disabled })\r\n    .eq(\"id\", workspaceId);\r\n  if (error) throw new Error(error.message);\r\n  const { data: workspace } = await admin\r\n    .from(\"workspaces\")\r\n    .select(\"name, user_id\")\r\n    .eq(\"id\", workspaceId)\r\n    .single();\r\n  if (workspace?.user_id) {\r\n    const { data: userData } = await admin.auth.admin.getUserById(\r\n      workspace.user_id as string\r\n    );\r\n    const ownerEmail = userData?.user?.email;\r\n    if (ownerEmail && workspace.name) {\r\n      if (disabled) {\r\n        await sendWorkspaceDisabledEmail(ownerEmail, workspace.name as string);\r\n      } else {\r\n        await sendWorkspaceEnabledEmail(ownerEmail, workspace.name as string);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/** Notify workspace admin by email when a new workspace is created (superadmin only). No-op if SMTP not configured. */\r\nexport async function notifyWorkspaceCreated(\r\n  workspaceName: string,\r\n  adminEmail: string\r\n): Promise<void> {\r\n  await requireSuperadmin();\r\n  await sendWorkspaceCreatedEmail(adminEmail, workspaceName);\r\n}\r\n\r\n/** Delete a workspace by id (superadmin only). Cascades to leads. */\r\nexport async function deleteWorkspace(workspaceId: number): Promise<void> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { error } = await admin.from(\"workspaces\").delete().eq(\"id\", workspaceId);\r\n  if (error) throw new Error(error.message);\r\n}\r\n\r\nconst WORKSPACE_APP_URL =\r\n  process.env.NEXT_PUBLIC_WORKSPACE_APP_URL ?? \"http://localhost:3002\";\r\n\r\n/** Get magic link to open workspace app as superadmin in the given workspace (superadmin only). */\r\nexport async function getWorkspaceLoginLink(\r\n  workspaceId: number\r\n): Promise<{ url: string }> {\r\n  const user = await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const redirectTo = `${WORKSPACE_APP_URL.replace(/\\/$/, \"\")}/auth/enter?workspace_id=${workspaceId}`;\r\n  const { data, error } = await admin.auth.admin.generateLink({\r\n    type: \"magiclink\",\r\n    email: user.email,\r\n    options: { redirectTo },\r\n  });\r\n  if (error) throw new Error(error.message);\r\n  const link =\r\n    (data as { properties?: { action_link?: string } })?.properties\r\n      ?.action_link;\r\n  if (!link) throw new Error(\"Failed to generate link\");\r\n  return { url: link };\r\n}\r\n"],"names":[],"mappings":";;;;;;;MA6GsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,2DAAA"}},
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///C:/wamp64/www/crm-leads/crm/apps/superadmin/src/app/actions/workspaces.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { getCurrentUser, getRole } from \"@crm/shared/auth\";\r\nimport { createSupabaseServerClient } from \"@/lib/supabase-server\";\r\nimport { createSupabaseAdminClient } from \"@/lib/supabase-admin\";\r\nimport {\r\n  sendWorkspaceCreatedEmail,\r\n  sendWorkspaceDisabledEmail,\r\n  sendWorkspaceEnabledEmail,\r\n} from \"@/lib/email\";\r\nimport type { Workspace } from \"@/lib/types\";\r\n\r\nconst SUPERADMIN_ONLY = \"Only superadmin can perform this action.\";\r\n\r\nasync function requireSuperadmin() {\r\n  const client = await createSupabaseServerClient();\r\n  const user = await getCurrentUser(client);\r\n  if (!user) throw new Error(\"Unauthorized\");\r\n  if (getRole(user) !== \"superadmin\") throw new Error(SUPERADMIN_ONLY);\r\n  return user;\r\n}\r\n\r\n/** Dashboard counts (superadmin only): total workspaces and total leads. */\r\nexport async function getDashboardCounts(): Promise<{\r\n  workspacesCount: number;\r\n  leadsCount: number;\r\n}> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const [workspacesRes, leadsRes] = await Promise.all([\r\n    admin.from(\"workspaces\").select(\"*\", { count: \"exact\", head: true }),\r\n    admin.from(\"leads\").select(\"*\", { count: \"exact\", head: true }),\r\n  ]);\r\n  return {\r\n    workspacesCount: workspacesRes.count ?? 0,\r\n    leadsCount: leadsRes.count ?? 0,\r\n  };\r\n}\r\n\r\n/** List all workspaces (superadmin only). Resolves owner email from auth. */\r\nexport async function listWorkspaces(): Promise<Workspace[]> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { data, error } = await admin\r\n    .from(\"workspaces\")\r\n    .select(\"id, name, user_id, disabled, created_at\")\r\n    .order(\"created_at\", { ascending: false });\r\n  if (error) throw new Error(error.message);\r\n  const rows = (data ?? []) as Workspace[];\r\n  const withEmailsAndCounts = await Promise.all(\r\n    rows.map(async (w) => {\r\n      let owner_email: string | null = null;\r\n      if (w.user_id?.trim()) {\r\n        const { data: userData } = await admin.auth.admin.getUserById(w.user_id);\r\n        owner_email = userData?.user?.email ?? null;\r\n      }\r\n      const { count } = await admin\r\n        .from(\"leads\")\r\n        .select(\"*\", { count: \"exact\", head: true })\r\n        .eq(\"workspace_id\", w.id);\r\n      const leads_count = count ?? 0;\r\n      return { ...w, owner_email, leads_count };\r\n    })\r\n  );\r\n  return withEmailsAndCounts;\r\n}\r\n\r\n/** Create a workspace (superadmin only). Uses current user as initial owner until workspace admin is created. */\r\nexport async function createWorkspace(name: string): Promise<Workspace> {\r\n  const user = await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { data, error } = await admin\r\n    .from(\"workspaces\")\r\n    .insert({ name, user_id: user.id })\r\n    .select(\"id, name, user_id, disabled, created_at\")\r\n    .single();\r\n  if (error) throw new Error(error.message);\r\n  return data as Workspace;\r\n}\r\n\r\n/** Create a workspace admin user in Supabase Auth and assign them as workspace owner (superadmin only). */\r\nexport async function createWorkspaceAdminUser(\r\n  workspaceId: number,\r\n  email: string,\r\n  password: string\r\n): Promise<void> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n\r\n  const { data: newUser, error: createError } = await admin.auth.admin.createUser({\r\n    email,\r\n    password,\r\n    email_confirm: true,\r\n    user_metadata: {\r\n      role: \"workspace_admin\",\r\n      workspace_id: workspaceId,\r\n    },\r\n  });\r\n  if (createError) throw new Error(createError.message);\r\n  if (!newUser.user) throw new Error(\"User creation failed\");\r\n\r\n  const { error: updateError } = await admin\r\n    .from(\"workspaces\")\r\n    .update({ user_id: newUser.user.id })\r\n    .eq(\"id\", workspaceId);\r\n  if (updateError) throw new Error(updateError.message);\r\n}\r\n\r\n/** Set workspace disabled flag (superadmin only). Disabled workspace admins cannot log in to the workspace app. Sends email to workspace admin. */\r\nexport async function updateWorkspaceDisabled(\r\n  workspaceId: number,\r\n  disabled: boolean\r\n): Promise<void> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { error } = await admin\r\n    .from(\"workspaces\")\r\n    .update({ disabled })\r\n    .eq(\"id\", workspaceId);\r\n  if (error) throw new Error(error.message);\r\n  const { data: workspace } = await admin\r\n    .from(\"workspaces\")\r\n    .select(\"name, user_id\")\r\n    .eq(\"id\", workspaceId)\r\n    .single();\r\n  if (workspace?.user_id) {\r\n    const { data: userData } = await admin.auth.admin.getUserById(\r\n      workspace.user_id as string\r\n    );\r\n    const ownerEmail = userData?.user?.email;\r\n    if (ownerEmail && workspace.name) {\r\n      if (disabled) {\r\n        await sendWorkspaceDisabledEmail(ownerEmail, workspace.name as string);\r\n      } else {\r\n        await sendWorkspaceEnabledEmail(ownerEmail, workspace.name as string);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/** Notify workspace admin by email when a new workspace is created (superadmin only). No-op if SMTP not configured. */\r\nexport async function notifyWorkspaceCreated(\r\n  workspaceName: string,\r\n  adminEmail: string\r\n): Promise<void> {\r\n  await requireSuperadmin();\r\n  await sendWorkspaceCreatedEmail(adminEmail, workspaceName);\r\n}\r\n\r\n/** Delete a workspace by id (superadmin only). Cascades to leads. */\r\nexport async function deleteWorkspace(workspaceId: number): Promise<void> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { error } = await admin.from(\"workspaces\").delete().eq(\"id\", workspaceId);\r\n  if (error) throw new Error(error.message);\r\n}\r\n\r\nconst WORKSPACE_APP_URL =\r\n  process.env.NEXT_PUBLIC_WORKSPACE_APP_URL ?? \"http://localhost:3002\";\r\n\r\n/** Get magic link to open workspace app as superadmin in the given workspace (superadmin only). */\r\nexport async function getWorkspaceLoginLink(\r\n  workspaceId: number\r\n): Promise<{ url: string }> {\r\n  const user = await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const redirectTo = `${WORKSPACE_APP_URL.replace(/\\/$/, \"\")}/auth/enter?workspace_id=${workspaceId}`;\r\n  const { data, error } = await admin.auth.admin.generateLink({\r\n    type: \"magiclink\",\r\n    email: user.email,\r\n    options: { redirectTo },\r\n  });\r\n  if (error) throw new Error(error.message);\r\n  const link =\r\n    (data as { properties?: { action_link?: string } })?.properties\r\n      ?.action_link;\r\n  if (!link) throw new Error(\"Failed to generate link\");\r\n  return { url: link };\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAoEsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,mDAAA"}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["file:///C:/wamp64/www/crm-leads/crm/apps/superadmin/src/app/actions/workspaces.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { getCurrentUser, getRole } from \"@crm/shared/auth\";\r\nimport { createSupabaseServerClient } from \"@/lib/supabase-server\";\r\nimport { createSupabaseAdminClient } from \"@/lib/supabase-admin\";\r\nimport {\r\n  sendWorkspaceCreatedEmail,\r\n  sendWorkspaceDisabledEmail,\r\n  sendWorkspaceEnabledEmail,\r\n} from \"@/lib/email\";\r\nimport type { Workspace } from \"@/lib/types\";\r\n\r\nconst SUPERADMIN_ONLY = \"Only superadmin can perform this action.\";\r\n\r\nasync function requireSuperadmin() {\r\n  const client = await createSupabaseServerClient();\r\n  const user = await getCurrentUser(client);\r\n  if (!user) throw new Error(\"Unauthorized\");\r\n  if (getRole(user) !== \"superadmin\") throw new Error(SUPERADMIN_ONLY);\r\n  return user;\r\n}\r\n\r\n/** Dashboard counts (superadmin only): total workspaces and total leads. */\r\nexport async function getDashboardCounts(): Promise<{\r\n  workspacesCount: number;\r\n  leadsCount: number;\r\n}> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const [workspacesRes, leadsRes] = await Promise.all([\r\n    admin.from(\"workspaces\").select(\"*\", { count: \"exact\", head: true }),\r\n    admin.from(\"leads\").select(\"*\", { count: \"exact\", head: true }),\r\n  ]);\r\n  return {\r\n    workspacesCount: workspacesRes.count ?? 0,\r\n    leadsCount: leadsRes.count ?? 0,\r\n  };\r\n}\r\n\r\n/** List all workspaces (superadmin only). Resolves owner email from auth. */\r\nexport async function listWorkspaces(): Promise<Workspace[]> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { data, error } = await admin\r\n    .from(\"workspaces\")\r\n    .select(\"id, name, user_id, disabled, created_at\")\r\n    .order(\"created_at\", { ascending: false });\r\n  if (error) throw new Error(error.message);\r\n  const rows = (data ?? []) as Workspace[];\r\n  const withEmailsAndCounts = await Promise.all(\r\n    rows.map(async (w) => {\r\n      let owner_email: string | null = null;\r\n      if (w.user_id?.trim()) {\r\n        const { data: userData } = await admin.auth.admin.getUserById(w.user_id);\r\n        owner_email = userData?.user?.email ?? null;\r\n      }\r\n      const { count } = await admin\r\n        .from(\"leads\")\r\n        .select(\"*\", { count: \"exact\", head: true })\r\n        .eq(\"workspace_id\", w.id);\r\n      const leads_count = count ?? 0;\r\n      return { ...w, owner_email, leads_count };\r\n    })\r\n  );\r\n  return withEmailsAndCounts;\r\n}\r\n\r\n/** Create a workspace (superadmin only). Uses current user as initial owner until workspace admin is created. */\r\nexport async function createWorkspace(name: string): Promise<Workspace> {\r\n  const user = await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { data, error } = await admin\r\n    .from(\"workspaces\")\r\n    .insert({ name, user_id: user.id })\r\n    .select(\"id, name, user_id, disabled, created_at\")\r\n    .single();\r\n  if (error) throw new Error(error.message);\r\n  return data as Workspace;\r\n}\r\n\r\n/** Create a workspace admin user in Supabase Auth and assign them as workspace owner (superadmin only). */\r\nexport async function createWorkspaceAdminUser(\r\n  workspaceId: number,\r\n  email: string,\r\n  password: string\r\n): Promise<void> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n\r\n  const { data: newUser, error: createError } = await admin.auth.admin.createUser({\r\n    email,\r\n    password,\r\n    email_confirm: true,\r\n    user_metadata: {\r\n      role: \"workspace_admin\",\r\n      workspace_id: workspaceId,\r\n    },\r\n  });\r\n  if (createError) throw new Error(createError.message);\r\n  if (!newUser.user) throw new Error(\"User creation failed\");\r\n\r\n  const { error: updateError } = await admin\r\n    .from(\"workspaces\")\r\n    .update({ user_id: newUser.user.id })\r\n    .eq(\"id\", workspaceId);\r\n  if (updateError) throw new Error(updateError.message);\r\n}\r\n\r\n/** Set workspace disabled flag (superadmin only). Disabled workspace admins cannot log in to the workspace app. Sends email to workspace admin. */\r\nexport async function updateWorkspaceDisabled(\r\n  workspaceId: number,\r\n  disabled: boolean\r\n): Promise<void> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { error } = await admin\r\n    .from(\"workspaces\")\r\n    .update({ disabled })\r\n    .eq(\"id\", workspaceId);\r\n  if (error) throw new Error(error.message);\r\n  const { data: workspace } = await admin\r\n    .from(\"workspaces\")\r\n    .select(\"name, user_id\")\r\n    .eq(\"id\", workspaceId)\r\n    .single();\r\n  if (workspace?.user_id) {\r\n    const { data: userData } = await admin.auth.admin.getUserById(\r\n      workspace.user_id as string\r\n    );\r\n    const ownerEmail = userData?.user?.email;\r\n    if (ownerEmail && workspace.name) {\r\n      if (disabled) {\r\n        await sendWorkspaceDisabledEmail(ownerEmail, workspace.name as string);\r\n      } else {\r\n        await sendWorkspaceEnabledEmail(ownerEmail, workspace.name as string);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/** Notify workspace admin by email when a new workspace is created (superadmin only). No-op if SMTP not configured. */\r\nexport async function notifyWorkspaceCreated(\r\n  workspaceName: string,\r\n  adminEmail: string\r\n): Promise<void> {\r\n  await requireSuperadmin();\r\n  await sendWorkspaceCreatedEmail(adminEmail, workspaceName);\r\n}\r\n\r\n/** Delete a workspace by id (superadmin only). Cascades to leads. */\r\nexport async function deleteWorkspace(workspaceId: number): Promise<void> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { error } = await admin.from(\"workspaces\").delete().eq(\"id\", workspaceId);\r\n  if (error) throw new Error(error.message);\r\n}\r\n\r\nconst WORKSPACE_APP_URL =\r\n  process.env.NEXT_PUBLIC_WORKSPACE_APP_URL ?? \"http://localhost:3002\";\r\n\r\n/** Get magic link to open workspace app as superadmin in the given workspace (superadmin only). */\r\nexport async function getWorkspaceLoginLink(\r\n  workspaceId: number\r\n): Promise<{ url: string }> {\r\n  const user = await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const redirectTo = `${WORKSPACE_APP_URL.replace(/\\/$/, \"\")}/auth/enter?workspace_id=${workspaceId}`;\r\n  const { data, error } = await admin.auth.admin.generateLink({\r\n    type: \"magiclink\",\r\n    email: user.email,\r\n    options: { redirectTo },\r\n  });\r\n  if (error) throw new Error(error.message);\r\n  const link =\r\n    (data as { properties?: { action_link?: string } })?.properties\r\n      ?.action_link;\r\n  if (!link) throw new Error(\"Failed to generate link\");\r\n  return { url: link };\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAiFsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,4DAAA"}},
    {"offset": {"line": 110, "column": 0}, "map": {"version":3,"sources":["file:///C:/wamp64/www/crm-leads/crm/apps/superadmin/src/app/actions/workspaces.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { getCurrentUser, getRole } from \"@crm/shared/auth\";\r\nimport { createSupabaseServerClient } from \"@/lib/supabase-server\";\r\nimport { createSupabaseAdminClient } from \"@/lib/supabase-admin\";\r\nimport {\r\n  sendWorkspaceCreatedEmail,\r\n  sendWorkspaceDisabledEmail,\r\n  sendWorkspaceEnabledEmail,\r\n} from \"@/lib/email\";\r\nimport type { Workspace } from \"@/lib/types\";\r\n\r\nconst SUPERADMIN_ONLY = \"Only superadmin can perform this action.\";\r\n\r\nasync function requireSuperadmin() {\r\n  const client = await createSupabaseServerClient();\r\n  const user = await getCurrentUser(client);\r\n  if (!user) throw new Error(\"Unauthorized\");\r\n  if (getRole(user) !== \"superadmin\") throw new Error(SUPERADMIN_ONLY);\r\n  return user;\r\n}\r\n\r\n/** Dashboard counts (superadmin only): total workspaces and total leads. */\r\nexport async function getDashboardCounts(): Promise<{\r\n  workspacesCount: number;\r\n  leadsCount: number;\r\n}> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const [workspacesRes, leadsRes] = await Promise.all([\r\n    admin.from(\"workspaces\").select(\"*\", { count: \"exact\", head: true }),\r\n    admin.from(\"leads\").select(\"*\", { count: \"exact\", head: true }),\r\n  ]);\r\n  return {\r\n    workspacesCount: workspacesRes.count ?? 0,\r\n    leadsCount: leadsRes.count ?? 0,\r\n  };\r\n}\r\n\r\n/** List all workspaces (superadmin only). Resolves owner email from auth. */\r\nexport async function listWorkspaces(): Promise<Workspace[]> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { data, error } = await admin\r\n    .from(\"workspaces\")\r\n    .select(\"id, name, user_id, disabled, created_at\")\r\n    .order(\"created_at\", { ascending: false });\r\n  if (error) throw new Error(error.message);\r\n  const rows = (data ?? []) as Workspace[];\r\n  const withEmailsAndCounts = await Promise.all(\r\n    rows.map(async (w) => {\r\n      let owner_email: string | null = null;\r\n      if (w.user_id?.trim()) {\r\n        const { data: userData } = await admin.auth.admin.getUserById(w.user_id);\r\n        owner_email = userData?.user?.email ?? null;\r\n      }\r\n      const { count } = await admin\r\n        .from(\"leads\")\r\n        .select(\"*\", { count: \"exact\", head: true })\r\n        .eq(\"workspace_id\", w.id);\r\n      const leads_count = count ?? 0;\r\n      return { ...w, owner_email, leads_count };\r\n    })\r\n  );\r\n  return withEmailsAndCounts;\r\n}\r\n\r\n/** Create a workspace (superadmin only). Uses current user as initial owner until workspace admin is created. */\r\nexport async function createWorkspace(name: string): Promise<Workspace> {\r\n  const user = await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { data, error } = await admin\r\n    .from(\"workspaces\")\r\n    .insert({ name, user_id: user.id })\r\n    .select(\"id, name, user_id, disabled, created_at\")\r\n    .single();\r\n  if (error) throw new Error(error.message);\r\n  return data as Workspace;\r\n}\r\n\r\n/** Create a workspace admin user in Supabase Auth and assign them as workspace owner (superadmin only). */\r\nexport async function createWorkspaceAdminUser(\r\n  workspaceId: number,\r\n  email: string,\r\n  password: string\r\n): Promise<void> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n\r\n  const { data: newUser, error: createError } = await admin.auth.admin.createUser({\r\n    email,\r\n    password,\r\n    email_confirm: true,\r\n    user_metadata: {\r\n      role: \"workspace_admin\",\r\n      workspace_id: workspaceId,\r\n    },\r\n  });\r\n  if (createError) throw new Error(createError.message);\r\n  if (!newUser.user) throw new Error(\"User creation failed\");\r\n\r\n  const { error: updateError } = await admin\r\n    .from(\"workspaces\")\r\n    .update({ user_id: newUser.user.id })\r\n    .eq(\"id\", workspaceId);\r\n  if (updateError) throw new Error(updateError.message);\r\n}\r\n\r\n/** Set workspace disabled flag (superadmin only). Disabled workspace admins cannot log in to the workspace app. Sends email to workspace admin. */\r\nexport async function updateWorkspaceDisabled(\r\n  workspaceId: number,\r\n  disabled: boolean\r\n): Promise<void> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { error } = await admin\r\n    .from(\"workspaces\")\r\n    .update({ disabled })\r\n    .eq(\"id\", workspaceId);\r\n  if (error) throw new Error(error.message);\r\n  const { data: workspace } = await admin\r\n    .from(\"workspaces\")\r\n    .select(\"name, user_id\")\r\n    .eq(\"id\", workspaceId)\r\n    .single();\r\n  if (workspace?.user_id) {\r\n    const { data: userData } = await admin.auth.admin.getUserById(\r\n      workspace.user_id as string\r\n    );\r\n    const ownerEmail = userData?.user?.email;\r\n    if (ownerEmail && workspace.name) {\r\n      if (disabled) {\r\n        await sendWorkspaceDisabledEmail(ownerEmail, workspace.name as string);\r\n      } else {\r\n        await sendWorkspaceEnabledEmail(ownerEmail, workspace.name as string);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/** Notify workspace admin by email when a new workspace is created (superadmin only). No-op if SMTP not configured. */\r\nexport async function notifyWorkspaceCreated(\r\n  workspaceName: string,\r\n  adminEmail: string\r\n): Promise<void> {\r\n  await requireSuperadmin();\r\n  await sendWorkspaceCreatedEmail(adminEmail, workspaceName);\r\n}\r\n\r\n/** Delete a workspace by id (superadmin only). Cascades to leads. */\r\nexport async function deleteWorkspace(workspaceId: number): Promise<void> {\r\n  await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const { error } = await admin.from(\"workspaces\").delete().eq(\"id\", workspaceId);\r\n  if (error) throw new Error(error.message);\r\n}\r\n\r\nconst WORKSPACE_APP_URL =\r\n  process.env.NEXT_PUBLIC_WORKSPACE_APP_URL ?? \"http://localhost:3002\";\r\n\r\n/** Get magic link to open workspace app as superadmin in the given workspace (superadmin only). */\r\nexport async function getWorkspaceLoginLink(\r\n  workspaceId: number\r\n): Promise<{ url: string }> {\r\n  const user = await requireSuperadmin();\r\n  const admin = createSupabaseAdminClient();\r\n  const redirectTo = `${WORKSPACE_APP_URL.replace(/\\/$/, \"\")}/auth/enter?workspace_id=${workspaceId}`;\r\n  const { data, error } = await admin.auth.admin.generateLink({\r\n    type: \"magiclink\",\r\n    email: user.email,\r\n    options: { redirectTo },\r\n  });\r\n  if (error) throw new Error(error.message);\r\n  const link =\r\n    (data as { properties?: { action_link?: string } })?.properties\r\n      ?.action_link;\r\n  if (!link) throw new Error(\"Failed to generate link\");\r\n  return { url: link };\r\n}\r\n"],"names":[],"mappings":";;;;;;;MA6IsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,0DAAA"}},
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///C:/wamp64/www/crm-leads/crm/apps/superadmin/src/app/%28dashboard%29/workspaces/CreateWorkspaceDrawer.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { Button } from \"@crm/shared/ui\";\r\nimport {\r\n  createWorkspace,\r\n  createWorkspaceAdminUser,\r\n  notifyWorkspaceCreated,\r\n} from \"../../actions/workspaces\";\r\n\r\nexport interface CreateWorkspaceDrawerProps {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  onSuccess?: () => void;\r\n}\r\n\r\nexport function CreateWorkspaceDrawer({\r\n  open,\r\n  onClose,\r\n  onSuccess,\r\n}: CreateWorkspaceDrawerProps) {\r\n  const router = useRouter();\r\n  const [formData, setFormData] = useState({\r\n    name: \"\",\r\n    admin_email: \"\",\r\n    admin_password: \"\",\r\n  });\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [submitting, setSubmitting] = useState(false);\r\n\r\n  const resetForm = () => {\r\n    setFormData({ name: \"\", admin_email: \"\", admin_password: \"\" });\r\n    setError(null);\r\n  };\r\n\r\n  const handleClose = () => {\r\n    resetForm();\r\n    onClose();\r\n  };\r\n\r\n  async function handleSubmit(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    const { name, admin_email, admin_password } = formData;\r\n    if (!name.trim()) {\r\n      setError(\"Workspace name is required.\");\r\n      return;\r\n    }\r\n    if (!admin_email.trim()) {\r\n      setError(\"Primary user email is required.\");\r\n      return;\r\n    }\r\n    if (!admin_password || admin_password.length < 6) {\r\n      setError(\"Password must be at least 6 characters.\");\r\n      return;\r\n    }\r\n    setSubmitting(true);\r\n    setError(null);\r\n    try {\r\n      const workspace = await createWorkspace(name.trim());\r\n      await createWorkspaceAdminUser(workspace.id, admin_email.trim(), admin_password);\r\n      await notifyWorkspaceCreated(name.trim(), admin_email.trim());\r\n      handleClose();\r\n      onSuccess?.();\r\n      router.refresh();\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : \"Failed to create workspace.\");\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  }\r\n\r\n  if (!open) return null;\r\n\r\n  return (\r\n    <div\r\n      className=\"fixed inset-0 z-40 flex justify-end transition-opacity duration-200\"\r\n      role=\"dialog\"\r\n      aria-modal=\"true\"\r\n      aria-labelledby=\"drawer-title\"\r\n    >\r\n      {/* Backdrop */}\r\n      <div\r\n        className=\"absolute inset-0 bg-black/40 transition-opacity duration-300\"\r\n        aria-hidden=\"true\"\r\n        onClick={handleClose}\r\n      />\r\n      {/* Drawer panel */}\r\n      <section\r\n        className=\"relative h-full w-full max-w-xl bg-white shadow-2xl flex flex-col transform transition-transform duration-300 translate-x-0\"\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        <header className=\"flex items-center justify-between border-b border-gray-200 px-6 py-4 shrink-0\">\r\n          <h2 id=\"drawer-title\" className=\"text-xl font-bold text-slate-900\">\r\n            Create New Workspace\r\n          </h2>\r\n          <button\r\n            type=\"button\"\r\n            className=\"rounded-full p-2 text-gray-500 transition hover:bg-gray-100 hover:text-gray-700 cursor-pointer\"\r\n            aria-label=\"Close\"\r\n            onClick={handleClose}\r\n          >\r\n            <svg\r\n              className=\"h-5 w-5\"\r\n              fill=\"none\"\r\n              stroke=\"currentColor\"\r\n              strokeLinecap=\"round\"\r\n              strokeLinejoin=\"round\"\r\n              strokeWidth={2}\r\n              viewBox=\"0 0 24 24\"\r\n            >\r\n              <path d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        </header>\r\n        <div className=\"flex-1 overflow-y-auto p-6\">\r\n          <form\r\n            onSubmit={handleSubmit}\r\n            className=\"grid gap-4 p-5 rounded-xl border border-slate-200 bg-gray-50/70\"\r\n          >\r\n            {error && (\r\n              <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 text-red-800 text-sm\">\r\n                {error}\r\n              </div>\r\n            )}\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n                Workspace name <span className=\"text-red-500\">*</span>\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                value={formData.name}\r\n                onChange={(e) =>\r\n                  setFormData((prev) => ({ ...prev, name: e.target.value }))\r\n                }\r\n                className=\"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\r\n                placeholder=\"Workspace name\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"pt-4 border-t border-slate-200\">\r\n              <h3 className=\"text-base font-semibold text-slate-900 mb-2\">\r\n                Primary user\r\n              </h3>\r\n              <p className=\"text-sm text-slate-600 mb-4\">\r\n                Create the workspace admin user. This user will own and manage\r\n                the workspace.\r\n              </p>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n                Email <span className=\"text-red-500\">*</span>\r\n              </label>\r\n              <input\r\n                type=\"email\"\r\n                value={formData.admin_email}\r\n                onChange={(e) =>\r\n                  setFormData((prev) => ({ ...prev, admin_email: e.target.value }))\r\n                }\r\n                className=\"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\r\n                placeholder=\"admin@example.com\"\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n                Password <span className=\"text-red-500\">*</span>\r\n              </label>\r\n              <input\r\n                type=\"password\"\r\n                value={formData.admin_password}\r\n                onChange={(e) =>\r\n                  setFormData((prev) => ({\r\n                    ...prev,\r\n                    admin_password: e.target.value,\r\n                  }))\r\n                }\r\n                className=\"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\r\n                placeholder=\"\"\r\n                minLength={6}\r\n              />\r\n              <p className=\"mt-1 text-xs text-slate-500\">\r\n                At least 6 characters\r\n              </p>\r\n            </div>\r\n\r\n            <div className=\"flex justify-end gap-3 pt-4\">\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"outline\"\r\n                onClick={handleClose}\r\n                className=\"cursor-pointer\"\r\n              >\r\n                Cancel\r\n              </Button>\r\n              <Button\r\n                type=\"submit\"\r\n                variant=\"primary\"\r\n                disabled={submitting}\r\n                className=\"cursor-pointer disabled:opacity-50\"\r\n              >\r\n                {submitting ? \"Creating\" : \"Create\"}\r\n              </Button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </section>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 488, "column": 0}, "map": {"version":3,"sources":["file:///C:/wamp64/www/crm-leads/crm/apps/superadmin/src/app/%28dashboard%29/workspaces/WorkspaceManager.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useRouter } from \"next/navigation\";\r\nimport { useState } from \"react\";\r\nimport { Button } from \"@crm/shared/ui\";\r\nimport {\r\n  deleteWorkspace,\r\n  getWorkspaceLoginLink,\r\n  updateWorkspaceDisabled,\r\n} from \"../../actions/workspaces\";\r\nimport type { Workspace } from \"@/lib/types\";\r\nimport { CreateWorkspaceDrawer } from \"./CreateWorkspaceDrawer\";\r\n\r\ninterface WorkspaceManagerProps {\r\n  initialWorkspaces: Workspace[];\r\n}\r\n\r\nexport function WorkspaceManager({ initialWorkspaces }: WorkspaceManagerProps) {\r\n  const router = useRouter();\r\n  const workspaces = initialWorkspaces;\r\n  const [isDrawerOpen, setIsDrawerOpen] = useState(false);\r\n  const [deleteId, setDeleteId] = useState<number | null>(null);\r\n  const [disableId, setDisableId] = useState<number | null>(null);\r\n  const [openId, setOpenId] = useState<number | null>(null);\r\n\r\n  const openDrawer = () => setIsDrawerOpen(true);\r\n  const closeDrawer = () => setIsDrawerOpen(false);\r\n\r\n  const handleCreateSuccess = () => {\r\n    router.refresh();\r\n  };\r\n\r\n  async function handleDisableToggle(w: Workspace) {\r\n    const action = w.disabled ? \"enable\" : \"disable\";\r\n    if (!w.disabled && !confirm(\"Disable this workspace? The workspace admin will not be able to log in until it is enabled again.\")) return;\r\n    setDisableId(w.id);\r\n    try {\r\n      await updateWorkspaceDisabled(w.id, !w.disabled);\r\n      router.refresh();\r\n    } catch (err) {\r\n      alert(err instanceof Error ? err.message : `Failed to ${action} workspace`);\r\n    } finally {\r\n      setDisableId(null);\r\n    }\r\n  }\r\n\r\n  async function handleOpenWorkspace(w: Workspace) {\r\n    if (w.disabled) return;\r\n    setOpenId(w.id);\r\n    try {\r\n      const { url } = await getWorkspaceLoginLink(w.id);\r\n      window.location.href = url;\r\n    } catch (err) {\r\n      alert(err instanceof Error ? err.message : \"Failed to open workspace\");\r\n      setOpenId(null);\r\n    }\r\n  }\r\n\r\n  async function handleDelete(id: number) {\r\n    if (!confirm(\"Delete this workspace and its leads?\")) return;\r\n    setDeleteId(id);\r\n    try {\r\n      await deleteWorkspace(id);\r\n      router.refresh();\r\n    } catch (err) {\r\n      alert(err instanceof Error ? err.message : \"Failed to delete\");\r\n    } finally {\r\n      setDeleteId(null);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header: title + Create New workspace button */}\r\n      <header className=\"flex flex-wrap justify-between items-center gap-3\">\r\n        <div className=\"space-y-1\">\r\n          <h2 className=\"text-lg font-semibold text-slate-800\">Workspaces</h2>\r\n          <p className=\"text-xs text-slate-500\">\r\n            Manage workspaces and workspace admin users\r\n          </p>\r\n        </div>\r\n        <Button\r\n          type=\"button\"\r\n          variant=\"primary\"\r\n          onClick={openDrawer}\r\n          className=\"cursor-pointer\"\r\n        >\r\n          Create New workspace\r\n        </Button>\r\n      </header>\r\n\r\n      {/* Workspaces table */}\r\n      <section className=\"overflow-hidden\">\r\n        <div className=\"overflow-x-auto rounded-lg border border-gray-200\">\r\n          <table className=\"min-w-full divide-y divide-gray-200\">\r\n            <thead className=\"bg-gray-50\">\r\n              <tr>\r\n                <th className=\"px-4 py-2 text-left text-sm font-medium text-gray-700\">\r\n                  Name\r\n                </th>\r\n                <th className=\"px-4 py-2 text-left text-sm font-medium text-gray-700\">\r\n                  Owner\r\n                </th>\r\n                <th className=\"px-4 py-2 text-left text-sm font-medium text-gray-700\">\r\n                  Leads\r\n                </th>\r\n                <th className=\"px-4 py-2 text-left text-sm font-medium text-gray-700\">\r\n                  Disabled\r\n                </th>\r\n                <th className=\"px-4 py-2 text-right text-sm font-medium text-gray-700\">\r\n                  Actions\r\n                </th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"bg-white divide-y divide-gray-200\">\r\n              {workspaces.length === 0 ? (\r\n                <tr>\r\n                  <td\r\n                    colSpan={5}\r\n                    className=\"px-4 py-6 text-center text-gray-500\"\r\n                  >\r\n                    No workspaces yet. Click &quot;Create New workspace&quot; to\r\n                    add one.\r\n                  </td>\r\n                </tr>\r\n              ) : (\r\n                workspaces.map((w) => (\r\n                  <tr\r\n                    key={w.id}\r\n                    className={\r\n                      w.disabled\r\n                        ? \"bg-red-50 text-red-800 border-l-4 border-red-400\"\r\n                        : \"\"\r\n                    }\r\n                  >\r\n                    <td className=\"px-4 py-2 text-sm font-medium\">{w.name}</td>\r\n                    <td\r\n                      className=\"px-4 py-2 text-sm text-gray-700 truncate max-w-[220px]\"\r\n                      title={w.owner_email ?? w.user_id}\r\n                    >\r\n                      {w.owner_email ?? w.user_id}\r\n                    </td>\r\n                    <td className=\"px-4 py-2 text-sm text-gray-600\">\r\n                      {w.leads_count ?? 0}\r\n                    </td>\r\n                    <td className=\"px-4 py-2 text-sm\">\r\n                      <span\r\n                        className={\r\n                          w.disabled\r\n                            ? \"font-semibold text-red-600\"\r\n                            : \"text-gray-600\"\r\n                        }\r\n                      >\r\n                        {w.disabled ? \"Yes\" : \"No\"}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"px-4 py-2 text-right\">\r\n                      <div className=\"flex items-center justify-end gap-2\">\r\n                        <Button\r\n                          type=\"button\"\r\n                          variant=\"primary\"\r\n                          disabled={w.disabled || openId === w.id}\r\n                          onClick={() => handleOpenWorkspace(w)}\r\n                          className=\"cursor-pointer\"\r\n                        >\r\n                          {openId === w.id ? \"Opening\" : \"Open\"}\r\n                        </Button>\r\n                        <Button\r\n                          type=\"button\"\r\n                          variant=\"outline\"\r\n                          disabled={disableId === w.id}\r\n                          onClick={() => handleDisableToggle(w)}\r\n                          className=\"cursor-pointer\"\r\n                        >\r\n                          {disableId === w.id\r\n                            ? \"\"\r\n                            : w.disabled\r\n                              ? \"Enable\"\r\n                              : \"Disable\"}\r\n                        </Button>\r\n                        <Button\r\n                          type=\"button\"\r\n                          variant=\"outline\"\r\n                          className=\"text-red-600 border-red-200 hover:bg-red-50\"\r\n                          disabled={deleteId === w.id}\r\n                          onClick={() => handleDelete(w.id)}\r\n                        >\r\n                          {deleteId === w.id ? \"Deleting\" : \"Delete\"}\r\n                        </Button>\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                ))\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Side panel (drawer): Create workspace + primary user */}\r\n      <CreateWorkspaceDrawer\r\n        open={isDrawerOpen}\r\n        onClose={closeDrawer}\r\n        onSuccess={handleCreateSuccess}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}