{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/wamp64/www/crm-leads/crm/apps/workspace/src/lib/constants.ts"],"sourcesContent":["export const LEAD_STATUSES = [\r\n  { value: \"new\", label: \"New\", pillClass: \"bg-blue-50 border-blue-200 text-blue-700\" },\r\n  { value: \"contacted\", label: \"Contacted\", pillClass: \"bg-purple-50 border-purple-200 text-purple-700\" },\r\n  { value: \"qualified\", label: \"Qualified\", pillClass: \"bg-amber-50 border-amber-200 text-amber-700\" },\r\n  { value: \"proposal\", label: \"Proposal\", pillClass: \"bg-slate-100 border-slate-200 text-slate-700\" },\r\n  { value: \"won\", label: \"Won\", pillClass: \"bg-green-50 border-green-200 text-green-700\" },\r\n  { value: \"lost\", label: \"Lost\", pillClass: \"bg-red-50 border-red-200 text-red-700\" },\r\n] as const;\r\n\r\nexport const LEAD_STATUS_OPTIONS = LEAD_STATUSES.map(({ value, label }) => ({ value, label }));\r\n\r\nexport const LEAD_STATUS_VALUES = LEAD_STATUSES.map(s => s.value);\r\n\r\nexport type LeadStatus = typeof LEAD_STATUS_VALUES[number];\r\n\r\nexport const isValidLeadStatus = (status: string): status is LeadStatus =>\r\n  LEAD_STATUS_VALUES.includes(status as LeadStatus);\r\n\r\nexport const getLeadStatusConfig = (status: LeadStatus) =>\r\n  LEAD_STATUSES.find(s => s.value === status);\r\n\r\nexport const LEAD_STATUS_MAP = Object.fromEntries(\r\n  LEAD_STATUSES.map(s => [s.value, s])\r\n) as Record<LeadStatus, typeof LEAD_STATUSES[number]>;"],"names":[],"mappings":";;;;;;;;;;;;;;AAAO,MAAM,gBAAgB;IAC3B;QAAE,OAAO;QAAO,OAAO;QAAO,WAAW;IAA2C;IACpF;QAAE,OAAO;QAAa,OAAO;QAAa,WAAW;IAAiD;IACtG;QAAE,OAAO;QAAa,OAAO;QAAa,WAAW;IAA8C;IACnG;QAAE,OAAO;QAAY,OAAO;QAAY,WAAW;IAA+C;IAClG;QAAE,OAAO;QAAO,OAAO;QAAO,WAAW;IAA8C;IACvF;QAAE,OAAO;QAAQ,OAAO;QAAQ,WAAW;IAAwC;CACpF;AAEM,MAAM,sBAAsB,cAAc,GAAG,CAAC,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,GAAK,CAAC;QAAE;QAAO;IAAM,CAAC;AAErF,MAAM,qBAAqB,cAAc,GAAG,CAAC,CAAA,IAAK,EAAE,KAAK;AAIzD,MAAM,oBAAoB,CAAC,SAChC,mBAAmB,QAAQ,CAAC;AAEvB,MAAM,sBAAsB,CAAC,SAClC,cAAc,IAAI,CAAC,CAAA,IAAK,EAAE,KAAK,KAAK;AAE/B,MAAM,kBAAkB,OAAO,WAAW,CAC/C,cAAc,GAAG,CAAC,CAAA,IAAK;QAAC,EAAE,KAAK;QAAE;KAAE"}},
    {"offset": {"line": 65, "column": 0}, "map": {"version":3,"sources":["file:///C:/wamp64/www/crm-leads/crm/apps/workspace/src/app/%28dashboard%29/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport Link from \"next/link\";\r\nimport { useAuth } from \"@crm/shared/hooks\";\r\nimport { useEffect, useState } from \"react\";\r\nimport type { Lead } from \"@/lib/types\";\r\nimport { LEAD_STATUSES, LEAD_STATUS_OPTIONS } from \"@/lib/constants\";\r\n\r\ntype StatusCounts = Record<string, number>;\r\n\r\nexport default function WorkspaceHome() {\r\n  const { client, workspace_id, user, loading: authLoading } = useAuth();\r\n  const [counts, setCounts] = useState<StatusCounts>({});\r\n  const [loading, setLoading] = useState(true);\r\n  const [selectedStatus, setSelectedStatus] = useState<string | null>(null);\r\n  const [leads, setLeads] = useState<Lead[]>([]);\r\n  const [leadsLoading, setLeadsLoading] = useState(false);\r\n  const [updatingStatusId, setUpdatingStatusId] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!client || workspace_id == null) {\r\n      if (!authLoading) setLoading(false);\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    client\r\n      .from(\"leads\")\r\n      .select(\"status\")\r\n      .eq(\"workspace_id\", workspace_id)\r\n      .eq(\"disabled\", false)\r\n      .limit(10000)\r\n      .then(({ data, error }) => {\r\n        if (error) {\r\n          setCounts({});\r\n          setLoading(false);\r\n          return;\r\n        }\r\n        const next: StatusCounts = {};\r\n        LEAD_STATUSES.forEach((s) => {\r\n          next[s.value] = 0;\r\n        });\r\n        (data ?? []).forEach((row: { status: string }) => {\r\n          const s = row.status?.toLowerCase() ?? \"new\";\r\n          next[s] = (next[s] ?? 0) + 1;\r\n        });\r\n        setCounts(next);\r\n        setLoading(false);\r\n      });\r\n  }, [client, workspace_id, authLoading]);\r\n\r\n  useEffect(() => {\r\n    if (!selectedStatus || !client || workspace_id == null) return;\r\n    const fetchLeads = async () => {\r\n      setLeadsLoading(true);\r\n      const { data, error } = await client\r\n        .from(\"leads\")\r\n        .select(\"*\")\r\n        .eq(\"workspace_id\", workspace_id)\r\n        .eq(\"disabled\", false)\r\n        .eq(\"status\", selectedStatus)\r\n        .order(\"created_at\", { ascending: false })\r\n        .limit(100);\r\n      if (!error && data) {\r\n        setLeads(data as Lead[]);\r\n      } else {\r\n        setLeads([]);\r\n      }\r\n      setLeadsLoading(false);\r\n    };\r\n    fetchLeads();\r\n  }, [selectedStatus, client, workspace_id]);\r\n\r\n  const handleStatusClick = (status: string) => {\r\n    setSelectedStatus(selectedStatus === status ? null : status);\r\n  };\r\n\r\n  const handleStatusChange = async (leadId: string, newStatus: string) => {\r\n    if (!client || workspace_id == null) return;\r\n    const lead = leads.find((l) => l.id === leadId);\r\n    if (!lead) return;\r\n    setUpdatingStatusId(leadId);\r\n    const { error: updateError } = await client\r\n      .from(\"leads\")\r\n      .update({ status: newStatus })\r\n      .eq(\"id\", leadId)\r\n      .eq(\"workspace_id\", workspace_id);\r\n    if (!updateError) {\r\n      setLeads((prev) =>\r\n        prev.map((l) => (l.id === leadId ? { ...l, status: newStatus } : l))\r\n      );\r\n      const description =\r\n        lead.status !== newStatus\r\n          ? `Status changed from ${lead.status} to ${newStatus}`\r\n          : `Status updated to ${newStatus}`;\r\n      await client.from(\"lead_activities\").insert({\r\n        workspace_id,\r\n        lead_id: leadId,\r\n        type: \"updated\",\r\n        description,\r\n        metadata: { status: newStatus },\r\n        created_by: user?.id ?? null,\r\n      });\r\n    }\r\n    setUpdatingStatusId(null);\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-0 space-y-6\">\r\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\r\n        <h1 className=\"text-2xl font-bold text-slate-900\">Workspace</h1>\r\n        <Link\r\n          href=\"/leads\"\r\n          className=\"inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium border border-slate-300 bg-white hover:bg-slate-50 text-slate-700\"\r\n        >\r\n          Leads\r\n        </Link>\r\n      </div>\r\n\r\n      {loading ? (\r\n        <p className=\"text-slate-500\">Loading…</p>\r\n      ) : (\r\n        <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4\">\r\n          {LEAD_STATUSES.map((status) => (\r\n            <div\r\n              key={status.value}\r\n              onClick={() => handleStatusClick(status.value)}\r\n              className={`rounded-xl border p-4 shadow-sm flex flex-col gap-3 cursor-pointer transition-all ${\r\n                selectedStatus === status.value\r\n                  ? \"border-indigo-500 bg-indigo-50 ring-2 ring-indigo-200\"\r\n                  : \"border-slate-200 bg-white hover:border-slate-300 hover:shadow-md\"\r\n              }`}\r\n            >\r\n              <div className=\"flex items-center justify-between gap-2\">\r\n                <span className=\"text-sm font-medium text-slate-600\">\r\n                  {status.label}\r\n                </span>\r\n                <span\r\n                  className={`inline-flex items-center rounded-full border px-2 py-0.5 text-xs font-medium ${status.pillClass}`}\r\n                >\r\n                  {status.label}\r\n                </span>\r\n              </div>\r\n              <p className=\"text-2xl font-bold text-slate-900\">\r\n                {counts[status.value] ?? 0}\r\n              </p>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n\r\n      {selectedStatus && (\r\n        <div className=\"space-y-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <h2 className=\"text-lg font-semibold text-slate-800\">\r\n              {LEAD_STATUSES.find((s) => s.value === selectedStatus)?.label} Leads\r\n            </h2>\r\n            <button\r\n              onClick={() => setSelectedStatus(null)}\r\n              className=\"text-sm text-slate-600 hover:text-slate-900\"\r\n            >\r\n              ✕ Close\r\n            </button>\r\n          </div>\r\n\r\n          {leadsLoading ? (\r\n            <p className=\"text-slate-500\">Loading leads…</p>\r\n          ) : (\r\n            <div className=\"overflow-x-auto rounded-lg border border-gray-200\">\r\n              <table className=\"min-w-full divide-y divide-gray-200\">\r\n                <thead className=\"bg-gray-50\">\r\n                  <tr>\r\n                    <th className=\"px-3 py-2 text-left text-xs font-medium text-gray-700\">\r\n                      Name\r\n                    </th>\r\n                    <th className=\"px-3 py-2 text-left text-xs font-medium text-gray-700\">\r\n                      Email\r\n                    </th>\r\n                    <th className=\"px-3 py-2 text-left text-xs font-medium text-gray-700\">\r\n                      Phone\r\n                    </th>\r\n                    <th className=\"px-3 py-2 text-left text-xs font-medium text-gray-700\">\r\n                      Company\r\n                    </th>\r\n                    <th className=\"px-3 py-2 text-left text-xs font-medium text-gray-700\">\r\n                      Channel\r\n                    </th>\r\n                    <th className=\"px-3 py-2 text-left text-xs font-medium text-gray-700\">\r\n                      Status\r\n                    </th>\r\n                    <th className=\"px-3 py-2 text-left text-xs font-medium text-gray-700\">\r\n                      Owner\r\n                    </th>\r\n                    <th className=\"px-3 py-2 text-right text-xs font-medium text-gray-700\">\r\n                      Actions\r\n                    </th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                  {leads.length === 0 ? (\r\n                    <tr>\r\n                      <td\r\n                        colSpan={8}\r\n                        className=\"px-3 py-6 text-center text-gray-500 text-sm\"\r\n                      >\r\n                        No leads found.\r\n                      </td>\r\n                    </tr>\r\n                  ) : (\r\n                    leads.map((lead) => (\r\n                      <tr key={lead.id}>\r\n                        <td className=\"px-3 py-2 text-sm font-medium\">\r\n                          {lead.name}\r\n                        </td>\r\n                        <td className=\"px-3 py-2 text-sm\">{lead.email}</td>\r\n                        <td className=\"px-3 py-2 text-sm\">{lead.phone}</td>\r\n                        <td className=\"px-3 py-2 text-sm\">\r\n                          {lead.company ?? \"—\"}\r\n                        </td>\r\n                        <td className=\"px-3 py-2 text-sm capitalize\">\r\n                          {lead.channel ?? \"—\"}\r\n                        </td>\r\n                        <td className=\"px-3 py-2 text-sm\">\r\n                          <select\r\n                            value={lead.status}\r\n                            onChange={(e) =>\r\n                              handleStatusChange(lead.id, e.target.value)\r\n                            }\r\n                            disabled={updatingStatusId === lead.id}\r\n                            className=\"capitalize rounded border border-slate-300 px-2 py-1 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 disabled:opacity-50 cursor-pointer\"\r\n                          >\r\n                            {LEAD_STATUS_OPTIONS.map((opt) => (\r\n                              <option key={opt.value} value={opt.value}>\r\n                                {opt.label}\r\n                              </option>\r\n                            ))}\r\n                          </select>\r\n                        </td>\r\n                        <td className=\"px-3 py-2 text-sm\">\r\n                          {lead.owner ?? \"—\"}\r\n                        </td>\r\n                        <td className=\"px-3 py-2 text-right text-sm\">\r\n                          <Link\r\n                            href={`/leads/${lead.id}`}\r\n                            className=\"text-indigo-600 hover:underline\"\r\n                          >\r\n                            View\r\n                          </Link>\r\n                        </td>\r\n                      </tr>\r\n                    ))\r\n                  )}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      <p className=\"text-slate-600 text-sm\">\r\n        Independent routing and layout for the workspace app.\r\n      </p>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}