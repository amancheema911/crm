{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/wamp64/www/crm-leads/crm/apps/workspace/src/app/auth/enter/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { createBrowserClient } from \"@supabase/ssr\";\r\nimport { useSearchParams } from \"next/navigation\";\r\n\r\nexport default function AuthEnterPage() {\r\n  const searchParams = useSearchParams();\r\n  const [status, setStatus] = useState<\"loading\" | \"error\">(\"loading\");\r\n  const [errorMessage, setErrorMessage] = useState<string | null>(null);\r\n  const done = useRef(false);\r\n\r\n  useEffect(() => {\r\n    if (done.current) return;\r\n    const url = process.env.NEXT_PUBLIC_SUPABASE_URL;\r\n    const anonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\r\n    if (!url || !anonKey) {\r\n      setStatus(\"error\");\r\n      setErrorMessage(\"App misconfigured\");\r\n      return;\r\n    }\r\n\r\n    const hash = typeof window !== \"undefined\" ? window.location.hash : \"\";\r\n    const workspaceId = searchParams.get(\"workspace_id\");\r\n    if (!workspaceId || !hash) {\r\n      setStatus(\"error\");\r\n      setErrorMessage(\"Missing token or workspace\");\r\n      return;\r\n    }\r\n\r\n    done.current = true;\r\n    const client = createBrowserClient(url, anonKey);\r\n    const params = new URLSearchParams(hash.slice(1));\r\n    const access_token = params.get(\"access_token\");\r\n    const refresh_token = params.get(\"refresh_token\");\r\n    if (!access_token || !refresh_token) {\r\n      setStatus(\"error\");\r\n      setErrorMessage(\"Invalid link\");\r\n      return;\r\n    }\r\n\r\n    client.auth\r\n      .setSession({ access_token, refresh_token })\r\n      .then(() =>\r\n        fetch(\r\n          `/api/auth/set-superadmin-workspace?workspace_id=${encodeURIComponent(workspaceId)}`\r\n        )\r\n      )\r\n      .then((r) => {\r\n        if (!r.ok) throw new Error(\"Failed to set workspace\");\r\n        window.location.href = \"/\";\r\n      })\r\n      .catch((err) => {\r\n        setStatus(\"error\");\r\n        setErrorMessage(err instanceof Error ? err.message : \"Something went wrong\");\r\n      });\r\n  }, [searchParams]);\r\n\r\n  if (status === \"error\") {\r\n    return (\r\n      <main className=\"min-h-screen flex items-center justify-center p-8\">\r\n        <div className=\"text-center text-red-600\">{errorMessage}</div>\r\n      </main>\r\n    );\r\n  }\r\n  return (\r\n    <main className=\"min-h-screen flex items-center justify-center p-8\">\r\n      <div className=\"text-gray-500\">Opening workspaceâ€¦</div>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAcgB;;AAZhB;AACA;AAAA;AACA;;;AAJA;;;;AAMe,SAAS;;IACtB,MAAM,eAAe,IAAA,wJAAe;IACpC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAsB;IAC1D,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAgB;IAChE,MAAM,OAAO,IAAA,uKAAM,EAAC;IAEpB,IAAA,0KAAS;mCAAC;YACR,IAAI,KAAK,OAAO,EAAE;YAClB,MAAM;YACN,MAAM;YACN;;YAMA,MAAM,OAAO,uCAAgC,OAAO,QAAQ,CAAC,IAAI,GAAG;YACpE,MAAM,cAAc,aAAa,GAAG,CAAC;YACrC,IAAI,CAAC,eAAe,CAAC,MAAM;gBACzB,UAAU;gBACV,gBAAgB;gBAChB;YACF;YAEA,KAAK,OAAO,GAAG;YACf,MAAM,SAAS,IAAA,oMAAmB,EAAC,KAAK;YACxC,MAAM,SAAS,IAAI,gBAAgB,KAAK,KAAK,CAAC;YAC9C,MAAM,eAAe,OAAO,GAAG,CAAC;YAChC,MAAM,gBAAgB,OAAO,GAAG,CAAC;YACjC,IAAI,CAAC,gBAAgB,CAAC,eAAe;gBACnC,UAAU;gBACV,gBAAgB;gBAChB;YACF;YAEA,OAAO,IAAI,CACR,UAAU,CAAC;gBAAE;gBAAc;YAAc,GACzC,IAAI;2CAAC,IACJ,MACE,CAAC,gDAAgD,EAAE,mBAAmB,cAAc;0CAGvF,IAAI;2CAAC,CAAC;oBACL,IAAI,CAAC,EAAE,EAAE,EAAE,MAAM,IAAI,MAAM;oBAC3B,OAAO,QAAQ,CAAC,IAAI,GAAG;gBACzB;0CACC,KAAK;2CAAC,CAAC;oBACN,UAAU;oBACV,gBAAgB,eAAe,QAAQ,IAAI,OAAO,GAAG;gBACvD;;QACJ;kCAAG;QAAC;KAAa;IAEjB,IAAI,WAAW,SAAS;QACtB,qBACE,6LAAC;YAAK,WAAU;sBACd,cAAA,6LAAC;gBAAI,WAAU;0BAA4B;;;;;;;;;;;IAGjD;IACA,qBACE,6LAAC;QAAK,WAAU;kBACd,cAAA,6LAAC;YAAI,WAAU;sBAAgB;;;;;;;;;;;AAGrC;GAhEwB;;QACD,wJAAe;;;KADd"}},
    {"offset": {"line": 117, "column": 0}, "map": {"version":3,"sources":["file:///C:/wamp64/www/crm-leads/crm/node_modules/next/navigation.js"],"sourcesContent":["module.exports = require('./dist/client/components/navigation')\n"],"names":[],"mappings":"AAAA,OAAO,OAAO","ignoreList":[0]}}]
}